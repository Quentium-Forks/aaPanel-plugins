
<style type="text/css">
	.waf_conter{height:650px;color:#444}.waf_left_menu{display:inline-block;width:132px;height:650px;background:#f0f0f1}.waf_left_menu li{padding:0 20px;height:60px;line-height:60px;cursor:pointer}.waf_left_menu li.active{background:#fff}.waf_left_menu .icon{display:inline-block}.waf_left_menu .icon i{color:#666;font-size:17px}.waf_left_menu span{margin-left:8px;color:#666;font-size:15px}.waf_rigth_body{position:absolute;top:0;right:0;bottom:0;left:129px;height:650px}.waf_rigth_body .item_con{display:none}.waf_rigth_body .item_con.active{display:block}.waf_switch>span{margin:0 5px;font-size:15px;line-height:30px}.switch-wrapper,.waf_switch>span{display:inline-block;height:30px;vertical-align:middle}.switch-wrapper{position:relative;z-index:0;overflow:hidden;width:88px;border:1px solid;border-color:#ccc;border-radius:4px;cursor:pointer}.switch-wrapper.swicth-sm{width:72px;height:26px}.waf_switch.swicth-sm>span{font-size:13px}.switch-wrapper.swicth-sm span{padding:3px 8px;width:36px;height:24px;font-size:11px}.switch-wrapper.swicth-sm .swicth_container{width:81pt;height:24px}.swicth_container{display:inline-block;width:129px;height:28px;border-radius:4px;vertical-align:middle;font-size:0;transition:all .5s;transform:translate3d(0,0,0)}.swicth_no{border-bottom-left-radius:3px;border-top-left-radius:3px;background:#5cb85c;color:#fff}.swicth_yes{border-top-right-radius:3px;border-bottom-right-radius:3px;background:#f0ad4e;color:#fff}.swicth_container span{display:inline-block;padding:5px 10px;width:43px;height:28px;vertical-align:top;text-align:center;font-size:9pt;line-height:1.5;line-height:18px;direction:ltr}.switch-wrapper.swicth-sm span i{display:inline-block;text-align:left;transform:scale(.85)}.switch-wrapper.swicth-sm .swicth_yes i{position:relative;left:-2px}.swicth_container span i{font-style:inherit}.switch-wrapper .waf_swicth{display:none}.waf_totall_data{margin:0;padding:0 40px;border-top:1px solid #f1f1f1;border-bottom:1px solid #f1f1f1}.waf_totall_data .item_center{margin:0 auto;padding:15px 0;min-width:200px}.waf_totall_data .icon{display:inline-block}.waf_totall_data .icon i{color:#5cb85c;font-size:60px}.waf_totall_data .grade_1 .icon i,.waf_totall_data .grade_1 .item_data{color:#5cb85c}.waf_totall_data .grade_2 .icon i,.waf_totall_data .grade_2 .item_data{color:#ffa501}.waf_totall_data .grade_3 .icon i,.waf_totall_data .grade_3 .item_data{color:#d9534f}.waf_totall_data .tips{display:inline-block;margin-left:20px}.waf_totall_data .item_title{display:block;margin-bottom:3px;text-align:center;font-size:17px}.waf_totall_data .item_data{display:block;text-align:center;font-weight:500;font-size:21px}.waf_totall_data .item_data i{font-style:initial}.waf_totall_data .item_data i:nth-child(2){margin-left:2px;font-size:1pc}.waf_other_data{margin:0;padding:20px 10px 20px 35px}.waf_other_data .item_conter{padding:25px 0}.waf_other_data .item_title{display:inline-block;font-size:15px}.waf_other_data .item_data{position:relative;top:1px;display:inline-block;margin-left:5px;color:#aaa;font-size:19px}.waf_other_data .grade_1 .item_data{color:#ffa501}.waf_other_data .grade_2 .item_data{color:#d9534f}.waf_other_tips{position:absolute;right:20px;bottom:25px;left:20px;padding:15px 0 0 20px;border-top:1px solid #f1f1f1;font-size:13px}.waf_table{border:1px solid #ececec}.waf_table>thead>tr{background:#f6f6f6}.waf_table>tbody>tr>td,.waf_table>thead>tr>th{padding:5px 10px;vertical-align:middle}.waf_table>thead>tr>th{height:35px;font-weight:500;line-height:35px}.waf_table>tbody>tr>td,.waf_table>thead>tr>th{border-bottom:1px solid #ececec;font-size:13px}.waf_table>tbody>tr>td{height:30px;color:#444;line-height:26px}.waf_table .btswitch-ios:checked+.btswitch-btn{background:#5cb85c}.waf_table .btswitch-ios+.btswitch-btn{border:none}.waf_table .btswitch+.btswitch-btn{position:relative;top:4px;margin-bottom:0;width:2.2em;height:1.3em}.waf_table>tbody>tr>td>span,.waf_unselect i{display:inline-block}.waf_unselect i{width:1pc;height:1pc;border:1px solid #d2d2d2;border-radius:2px;background-color:#fff;vertical-align:text-bottom;text-align:center;font-size:9pt;line-height:1pc;cursor:pointer;transition:.1s linear}.waf_unselect input{display:none}.tipsval{margin-left:7px;color:#999}.tipsval.grade_1{color:#ffa501}.tipsval.grade_2{color:#d9534f}.waf_unselect .waf-checked{border:1px solid#5fb878;background:#5cb85c}.waf_unselect .waf-checked span{width:9pt;height:9pt;color:#fff;transform:scale(.8,.8)}.waf_page{float:right;padding:0 5px;height:30px;font-size:13px}.waf_page span.Pcurrent{display:inline-block;margin-right:2px;width:30px;height:30px;border-radius:2px;background-color:#5cb85c;color:#fff;text-align:center;line-height:30px}.waf_page span.Pcount{margin-right:0;margin-left:5px}.waf_page a{display:inline-block;margin:0 3px;padding:0 10px;height:30px;border-radius:2px;background-color:#f5f5f5;color:#666;text-align:center;line-height:30px;cursor:pointer}.waf_page a:hover{background:#e5e5e5}.waf-icon-ok .glyphicon-ok{display:none}.waf-icon-ok.waf-checked .glyphicon-ok{display:inline-block}.waf-form{padding:25px}.waf-line,.waf-lines{margin-bottom:15px}.waf-line{height:2pc;line-height:2pc}.waf-line-tips,.waf-line.waf_one{margin-bottom:0}.waf-line-tips{margin-top:20px}.waf-line .name-l,.waf-lines .name-l{display:inline-block;margin:0 10px;width:70px;color:#666;text-align:right;font-size:13px}.waf-line .info-r{height:2pc;line-height:2pc}.waf-line .info-r,.waf-lines .info-r{display:inline-block;vertical-align:top}.waf-line .info-r input{padding:2px 2px 2px 4px;border-radius:2px}.waf-input{padding:2px 2px 2px 6px;height:2pc;border:1px solid #ccc;border-radius:2px;line-height:2pc;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.waf_input_tips{display:inline-block;margin-left:5px;height:2pc;color:#999;line-height:2pc}.waf_tips_list{margin-top:15px;margin-left:25px;color:#666}.waf_tips_list li{list-style-type: disc;line-height:21px;}.waf_tips_list .key{color:red}.cc_rule_form{padding:35px 25px 15px 35px}.other_table{overflow:auto;padding:25px 15px}.waf-fht-cell{overflow:hidden;height:1px}.fixed-table{margin-bottom:0}.fixed-table-view{position:relative;overflow-x:hidden;overflow-y:auto;padding-right:1px;border-radius:3px;}.fixed-table-thead{position:absolute;top:0;z-index:9999}.fixed-table-shadow{box-shadow:2px 2px 4px rgba(0,0,0,.1)}.waf-form-input{margin-bottom:15px}.waf-form-input input{height:35px;line-height:35px}.other_table .waf-form-input input:nth-child(1){margin-right:10px;width:530px;height:35px;line-height:35px}.other_table .waf-form-input input:nth-child(2){margin-right:10px;width:150px;height:35px;line-height:35px}.waf-form-input button{padding:4px 15px;height:35px;font-size:13px}.waf-table-textarea{position:relative;top:5px;height:auto;line-height:20px}.ip_region_table,.other_rule_table{padding:25px 15px}.ip_region_table .waf-form-input input:nth-child(1){margin-right:10px;width:215px}.other_rule_table .waf-form-input input:nth-child(1){width:440px}.ip_region_table .waf-form-input input:nth-child(2){width:215px}.scan_rule_form .waf-input{width:430px;height:82px;line-height:18px}.mtl0{margin-top:0;margin-left:15px}.site_logs_table{padding:20px}.waf_date_select{margin-bottom:15px}.waf-unselect{position:relative;display:inline-block;height:38px;border:1px solid #e6e6e6;border-radius:2px;font-size:13px;line-height:28px}.waf-unselect .waf-inputs{box-sizing:border-box;padding:5px 40px 5px 15px;height:38px;cursor:pointer}.waf-unselect.active .waf-inputs:after{transform:rotate(180deg)}.waf-unselect .waf-inputs:after{position:absolute;top:1pc;right:9pt;display:block;width:0;height:0;border-color:#c2c2c2 transparent transparent;border-style:solid;border-width:6px 6px 0;content:'';transition:transform .5s}.waf-unselect.active .waf-input-list{animation-name:layui-upbit;animation-duration:.3s;animation-fill-mode:both}.waf-input-list{position:absolute;top:42px;right:-1px;left:-1px;z-index:899;display:none;box-sizing:border-box;padding:5px 0;height:auto;min-width:100%;border:1px solid #d2d2d2;border-radius:2px;background-color:#fff;box-shadow:0 2px 4px rgba(0,0,0,.12)}.waf-unselect.active .waf-input-list{display:block}.waf-input-list dd{padding:5px 15px;height:38px;line-height:30px}.waf-input-list dd.waf_checked{background:#5fb878!important;color:#fff}.waf-input-list dd:hover{background-color:#f2f2f2;cursor:pointer}.waf_date_select .waf-title{display:inline-block;width:auto;height:40px;font-size:14px;line-height:40px}.divpre{overflow:auto;margin:0 0 10px;padding:9.5px;max-height:75pt;border:1px solid #ddd;border-radius:4px;background-color:#f6f6f6;color:#333;word-wrap:break-word;font-size:13px;line-height:1.42857143;word-break:break-all}.lib-con{margin-bottom:10px;width:100%}#site_logs_table{margin-top:15px}
	.waf_nav_group{
		height: 36px;
    	line-height: 36px;
		border-bottom: 1px solid #ececec;
		font-size: 0;
	}
	.waf_nav_group span{
		display: inline-block;
		height: 36px;
		padding: 0 25px;
		font-size: 13px;
		cursor: pointer;
		color: #444;
		border: 1px solid #fff;
		border-bottom:none;
		position: relative;
		top: -1px;
	}
	.waf_nav_group span.active{
		border: 1px solid #ececec;
		line-height: 34px;
		color: #444;
		border-bottom-color:#fff;
		border-top-left-radius: 2px;
		border-top-right-radius: 2px;
	}
	.waf_nav_content{
		display: block;
		position: relative;
	}
	.waf_nav_content .waf_nav_item{
		display: none;
		padding-top: 15px;
	}
	.waf_nav_content .waf_nav_item.active{
		display: block;
	}
	.waf_nav_content .webshell_logs{
		background-color: #424251;
		width: 100%;
		height: 560px;
		padding: 10px;
		color: #fff;
		line-height: 17px;
		border-radius: 2px;
		outline: none;
		resize:none;
	}
	.waf_nav_item .waf_nav_header select{
		height: 34px;
		font-size: 14px;
	}
	.waf_nav_item .waf_nav_header{
		margin-bottom: 15px;
	}
	.input_list_two input{
		height: 34px;
	}
	.input_list_two{
		margin-right: 15px;
	}
	.file_rule span{
		width:220px;
		vertical-align: bottom;
		overflow: hidden;
		text-overflow:ellipsis;
		white-space: nowrap;
		position: relative;
		cursor: pointer;
	}
	.rule_down_icon{
		width: 25px;
		height: 42px;
		line-height: 42px;
		text-align: center;
		background: #fff;
		border:1px solid #ececec;
		position: absolute;
		right: 0;
		top: 5px;
		cursor: pointer;
	}
	.rule_mask{
		position: absolute;
		z-index: 999999;
		top: 48px;
		line-height: 18px;
		background: #fff;
		box-shadow: 0 1px 8px rgba(0,0,0,.2);
		padding: 10px 15px;
		max-width: 300px;
	}
	.rule_mask .iconfont{
		font-size: 23px;
		position: absolute;
		background: #fff;
		top: -9px;
		right: -11px;
		cursor: pointer;
	}
	.file_rule_link{
		width: 180px;
		vertical-align: bottom;
		overflow: hidden;
		text-overflow:ellipsis;
		white-space: nowrap;
		position: relative;
		cursor: pointer;
	}

	table tr td{

        width:auto;

        max-width:200px;

        word-break:break-all;

        word-wrap:break-word;

    }	

</style>
<link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_1474105_ofrmqg44wnb.css" />
<div class="waf_conter">
	<ul class="waf_left_menu">
		<li class="active"><div class="icon"><i class="iconfont iconshouye"></i></div><span>Home</span></li>
		<li><div class="icon"><i class="iconfont iconpeizhi"></i></div><span>Global</span></li>
		<li><div class="icon"><i class="iconfont iconwangzhan"></i></div><span>Site</span></li>
		<li><div class="icon"><i class="iconfont iconsaomiao"></i></div><span>Webshell</span></li>
		<li><div class="icon"><i class="iconfont iconsuo"></i></div><span>Blockade</span></li>
		<li><div class="icon"><i class="iconfont iconcaozuorizhi"></i></div><span>Log</span></li>
	</ul>
	<div class="waf_rigth_body pd20">
		<div class="item_con active" data-type="home">
			<div class="waf_switch mtb20">
				<span>Firewall switch</span>
				<div class="switch-wrapper">
					<div class="swicth_container" data-type="1">
						<span class="swicth_no">ON</span>
						<span class="swicth_label"></span>
						<span class="swicth_yes">OFF</span>
						<input type="checkbox" id="waf_swicth_all"/>
					</div>
				</div>
			</div>
			<div class="waf_totall_data row">
				<div class="col-sm-6 col-xs-6 item_mode waf_total grade_1">
					<div class="item_center">
						<div class="icon"><i class="iconfont iconlanjie"></i></div>
						<div class="tips">
							<span class="item_title">Risk interception</span>
							<span class="item_data"><i>--</i><i>Times</i></span>
						</div>
					</div>
				</div>
				<div class="col-sm-6 col-xs-6 item_mode waf_safe_day grade_1">
					<div class="item_center">
						<div class="icon"><i class="iconfont iconanquan"></i></div>
						<div class="tips">
							<span class="item_title">Safety protection</span>
							<span class="item_data"><i>--</i><i>Day</i></span>
						</div>
					</div>
				</div>
			</div>
			<div class="waf_other_data row"></div>
			<div class="waf_other_tips">Note: The current firewall switch is the main switch. After the shutdown, all stations will lose protection. Please operate with caution.</div>
		</div>
		<div class="item_con" data-type="overall">
			<button class="btn btn-success update_rule" type="button" style="margin-bottom:12px;display: none;">Update rule base</button>
			<div id="overall_table"></div>
			<ul class="waf_tips_list mtl0 c7" style="font-size: 13px;position: absolute;bottom: 20px;padding-right: 40px;">
				<li>Inheritance: Global settings are automatically inherited as default values in the site configuration</li>
				<li>Priority: UA whitelist&gt; UA blacklist&gt; URL keyword interception&gt; IP whitelist &gt; IP blacklist &gt; URL whitelist &gt; URL blacklist &gt; CC defense &gt; Prohibit foreign IP access &gt; User-Agent &gt; URI overload &gt; URL parameter &gt; Cookie &gt; POST</li>
			</ul>
		</div>
		<div class="item_con" data-type="site">
			<div id="site_table"></div>
		</div>
		<div class="item_con" data-type="webshell">
			<div class="waf_nav_group">
				<span class="active">Check</span>
				<span>Rule list</span>
				<span>Logs</span>
			</div>
			<div class="waf_nav_content">
				<div class="active waf_nav_item" data-type="killing">
					<div class="waf_nav_header">
						<select class="bt-input-text mr5" style="width:120px" name="dir_path">
							<option value="0" selected="">Site directory</option>
							<option value="1">Custom directory</option>
						</select>
						<div class="input_list_one" style="display: inline-block;">
							<select class="bt-input-text mr5" style="width:180px" name="static_site_list"></select>
						</div>
						<div class="input_list_two" style="display: none;">
							<input type="text" class="bt-input-text mr5" id="san_path" style="width:250px">
							<span data-id="path" class="glyphicon cursor ml5 glyphicon-folder-open" ></span>
						</div>
						<button class="btn btn-success va0" id="san_webshell_event">Scan Trojan</button>
					</div>
					<div class="waf_nav_body">
						<div id="scan_webshell_table"></div>
					</div>
					<ul class="help-info-text c7">
              <li style="color:red">The dynamic scanning method is to analyze whether the behavior of the Trojan or the connector is recorded and intercepted from the traffic.</li>
              <li style="color:red">Deleting a file does not delete the file but deletes the data in the list. If you need to delete the file, you need to operate in the file management.</li>
              <li style="color:red">Third party scanner comes from WEBDIR+ <a href="https://www.bt.cn/bbs/thread-39234-1-1.html" class="btlink">The specific documents are as follows</a></li>
          </ul>
				</div>
				<div class="waf_nav_item" data-type="rule_list">
					<button class="btn btn-success add_webshell_rule" type="button" style="margin-bottom:12px;">Add rules</button>
					<div id="webshell_rule_table"></div>
				</div>
				<div class="waf_nav_item" data-type="logs">
					<textarea class="webshell_logs" readonly="readonly"></textarea>
				</div>
			</div>
		</div>
		<div class="item_con" data-type="history">
			<button class="btn btn-success uncover_all" type="button" style="margin-bottom:12px;">Unblock all</button>
			<div id="history_table"></div>
			<div class="history_uncover_page waf_page"></div>
		</div>
		<div class="item_con" data-type="logs">
			<div id="logs_table"></div>
		</div>
		<div class="loading_mask"></div>
	</div>
</div>
<script src="https://cdn.bootcss.com/fixed-header-table/1.3.0/jquery.fixedheadertable.min.js"></script>
<script type="text/javascript">
	var free_waf = {
		plugin_name:'free_waf',
		total_all:{}, //统计数据
		overall_config:{}, //全局配置参数
		site_config:{}, //站点配置参数
		rule_list:[],
		drop_abroad_list:[],
		waf_table_list:[],
		ip_config_list:[],
		overall_show_config:[
			{name:'CC defense',type:'cc',ps:'Defense against CC attacks.'},
			{name:'GET-URL filter',type:'get',ps:'Filter uri parameters common sql injection, xss and other attacks'},
			{name:'GET-parameter filter',type:'get',ps:'Filter uri parameters common sql injection, xss and other attacks'},
			{name:'POST filter',type:'post',ps:'Filter POST parameters common sql injection, xss and other attacks'},
			{name:'UA filter',type:'user-agent',ps:'Usually used to filter browsers, spiders, and some automatic scanners'},
			// {name:'Prohibit foreign visits',type:'drop_abroad',ps:'Prohibit access to sites outside of mainland China'},
			{name:'Scanner',type:'scan',ps:'Filter penetration test of common scanning test tools'},
			{name:'IP whitelist',type:'ip_white',ps:'All rules are invalid for IP whitelist',status:'',open:''},
			{name:'IP blacklist',type:'ip_black',ps:'Prohibited access to IP',open:''},
			{name:'URL whitelist',type:'url_white',ps:'Most rules are invalid for URL whitelists',status:'',open:''},
			{name:'URL blacklist',type:'url_black',ps:'URLs that prohibit users from accessing',status:'',open:''}
		],
		site_show_config:[],
		// 初始化
		init:function(){
			var _this = this;
			setTimeout(function(){
				$('.layui-layer-page').width(920).css({
					'top':(document.body.clientHeight-690)/2+'px',
					'left':(document.body.clientWidth-920)/2+'px'
				})
			},1);
			// 菜单跳转
			$('.waf_left_menu li').click(function(){
				var _index = $(this).index(), _type = $('.waf_rigth_body .item_con:eq('+ _index +')').attr('data-type');
				$(this).addClass('active').siblings().removeClass('active');
				$('.waf_rigth_body .item_con:eq('+ _index +')').addClass('active').siblings().removeClass('active');
				_this.refresh_data_total(_type);
			});
			// webshell菜单
			$('.waf_nav_group span').click(function(){
				var _index = $(this).index(), _type = $('.waf_nav_content .waf_nav_item:eq('+ _index +')').attr('data-type');
				$(this).addClass('active').siblings().removeClass('active');
				$('.waf_nav_content .waf_nav_item:eq('+ _index +')').addClass('active').siblings().removeClass('active');
				_this.refresh_data_webshell(_type);
			});
			// 选择 类型
			$('[name="dir_path"]').change(function() {
				if($(this).val() == '0'){
					$('.input_list_one').css('display','inline-block');
					$('.input_list_two').hide();
				}else{
					$('.input_list_two').css('display','inline-block');
					$('.input_list_one').hide();
				}
			});
			//文件图标按钮
			$('span[data-id="path"]').click(function(){
				bt.select_path('san_path');
			});
			//扫描木马按钮
			$('#san_webshell_event').click(function(){
				var type = $('[name="dir_path"]').val(),path = '';
				if(type == "0"){
					path = $('[name="static_site_list"]').val();
				}else{
					path = $('#san_path').val();
					if(path == ''){
						layer.msg('Scan address cannot be empty!',{icon:1});
						return false;
					}
				}
				_this.webshell_san_dir({path:path},function(res){
					_this.render_san_webshell({data:res,path:path});
				});
			});
			// 添加webshell规则
			$('.add_webshell_rule').click(function() {
				layer.open({
					type: 1,
					title: 'Add rules',
					area: ['340px', '215px'],
					closeBtn: 2,
					shadeClose: false,
					btn:['Confirm','Cancel'],
					content: '<div class="waf-form">\
							<div class="waf-line">\
								<span class="name-l" style="width:30px">Rule</span>\
								<div class="info-r">\
									<textarea name="webshell_rule" style="border:1px solid #ccc;border-radius:2px;width:220px;line-height: 15px;height: 75px;"></textarea>\
								</div>\
							</div>\
						</div>',
					yes:function(index,layers){
						var _rule = $('[name="webshell_rule"]').val();
						if (_rule == '') {
							layer.msg('Rules cannot be empty!', {icon: 2});
							return false;
						}
						_this.add_webshell_rule({rule:_rule},function(res){
							layer.close(index);
							_this.refresh_data_webshell('rule_list');
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					}
				});
			});
			// 解封所有封锁
			$('.uncover_all').click(function(){
				layer.confirm('Do you want to unblock all IPs from the firewall?', { title: 'Unblock the IP address ',closeBtn:2,icon:0}, function () {
					_this.clean_waf_drop_ip(function(res){
						_this.render_history_data();
						layer.msg(res.msg,{icon:res.status?1:2});
					});
				});
			});
			// 防火墙开关
			$('.switch-wrapper').click(function(){
				var _type = Boolean(parseInt($(this).find('.swicth_container').attr('data-type')));
				_this.set_swicth_view(this,_type);
				_this.open_waf_req(function(res){
					layer.msg(res.msg,{icon:res.status?1:2});
				});
			});
			// 防火墙select
			$('.item_con').on('click','.waf_unselect',function(){
				var _checked = $(this).find('input').prop('checked');
				if(_checked){
					$(this).find('.waf-icon').removeClass('waf-checked');
					$(this).find('input').prop('checked',false);
				}else{
					$(this).find('.waf-icon').addClass('waf-checked');
					$(this).find('input').prop('checked',true);
				}
			});
			// 更新全局规则库
			$('.update_rule').click(function(){
				_this.update_overall_rule(function(res){
					layer.msg(res.msg,{icon:res.status?1:2});
				});
			});
			this.render_san_webshell({data:[]});
			this.return_site_list(function(res){
				var _option = '',rdata = res.msg;
				for (var i in rdata) {
					_option += '<option value="' + rdata[i] + '">' + i + '</option>'
				}
				$('[name="static_site_list"]').html(_option);
			});
			this.refresh_data_total('home');


		},
		// 设置防火墙开关状态视图
		set_swicth_view:function(that,type){
			var swicth_container = $(that).find('.swicth_container');
			var _width = $(that).find('.swicth_no')[0].offsetWidth;
			if(type){
				swicth_container.css({
					'transform':'translate3d(-'+ _width +'px,0,0)',
					'-webkit-transform':'translate3d(-'+ _width +'px,0,0)'
				}).attr('data-type',0)
			}else{
				swicth_container.css({
					'transform':'translate3d(0,0,0)',
					'-webkit-transform':'translate3d(0,0,0)'
				}).attr('data-type',1)
			}
			$('#waf_swicth_all').prop('checked',!type);
		},
		// 日志跳转页面
		get_gl_table_page:function(p){
			if(p == undefined) p=1
			this.render_logs_data({p:p,tojs:'free_waf.get_gl_table_page'});
		},
		// 刷新webshell页面数据
		refresh_data_webshell:function(type){
			var _this = this;
			switch(type){
				case 'killing': //查杀

				break;
				case 'rule_list': //规则列表
					_this.render_webshell_rule();
				break;
				case 'logs': //日志
					_this.get_webshell_log(function(res){
						$('.webshell_logs').html(res);
						$('.webshell_logs').scrollTop(99999999);
					});
				break;
			}
		},
		// 刷新页面数据
		refresh_data_total:function(type){
			var _this = this;
			switch(type){
				case 'home': //首页
					this.get_total_all(function(res){
						var rules = res.total.rules,_html = '';
						_this.total_all = res;
						_this.set_swicth_view('.switch-wrapper',!_this.total_all.open);
						$('.waf_total').addClass(_this.total_all.total.total>0?'grade_2':'grade_1').find('.item_data i:eq(0)').html(_this.addThousands(_this.total_all.total.total));
						$('.waf_safe_day').find('.item_data i:eq(0)').html(_this.total_all.safe_day);
						for(var i= 0;i< rules.length;i++){
							_html += '<div class="item_conter col-sm-4 col-xs-4 '+ ( rules[i]['value'] > 0?'grade_1':(rules[i]['value'] > 100?'grade_2':'')) +'">\
								<div class="item_title">'+ rules[i]['name'] +':</div>\
								<div class="item_data">'+ _this.addThousands(rules[i]['value']) +'</div>\
							</div>'
						}
						$('.waf_other_data').html(_html);
					});
				break;
				case 'overall': //全局
					this.get_overall_config(function(res){
						_this.overall_config = res;
						for(var i=0;i<_this.overall_show_config.length;i++){
							var _type = _this.overall_config[_this.overall_show_config[i]['type']];
							if(_this.overall_show_config[i]['ps'] === undefined) _this.overall_show_config[i]['ps'] = (_type !== undefined?_type['ps']:'');
							_this.overall_show_config[i]['status'] = (_type != undefined?_type['status']:'');
							_this.overall_show_config[i]['open'] = (_type != undefined?_type['open']:'');
						}
						// _this.overall_show_config[8].status = _this.overall_config.cc.status;
						_this.overall_show_config[9].status = _this.overall_config.get.status;
						_this.refresh_table_view({
							el:'#overall_table',
							form_id:'overall_table', //用于重置
							height:500,
							config:[
								{fid:'name',title:'Name',width:'120px'},
								{fid:'ps',title:'Description'},
								{fid:'status',type:'link',title:'Response',width:'50px',style:'text-align: center;',event:function(row,index,event){
									layer.open({
										type: 1,
										title: 'Set the response code [ '+ row.name +' ]',
										area: '350px',
										closeBtn: 2,
										btn:['Apply','Cancel'],
                						content:'<div class="waf-form pd20">\
											<div class="waf-line waf_one">\
												<span class="name-l">Response code</span>\
												<div class="info-r">\
													<select id="statusCode" class="bt-input-text mr5" style="width: 175px;">\
													    <option value="200">Normal (200)</option>\
													    <option value="404">File does not exist (404)</option>\
													    <option value="403">Access denied (403)</option>\
													    <option value="444">Close connection (444)</option>\
													    <option value="500">Application error (500)</option>\
													    <option value="502">Connection timeout (502)</option>\
													    <option value="503">Server not available (503)</option>\
													</select>\
												</div>\
											</div>\
										</div>',
										success:function(index, layero){
											$('#statusCode').val(row.status);
										},
										yes:function(index,layero){
											var _type = row.type;
											if(_type == 'ip_black') _type = 'cc'
											if(_type == 'url_black') _type = 'get';
											_this.set_status_code({obj:_type,code:$('#statusCode').val()},function(res){
												_this.refresh_data_total('overall');
												layer.close(index);
												layer.msg(res.msg,{icon:res.status?1:2});
											});
										}
									});
								}},
								{fid:'open',type:'btswitch',title:'Status',width:'60px',style:'text-align: center;',event:function(row,index,event){
									_this.set_open_switch({obj:row.type},function(res){
										_this.refresh_data_total('overall');
										layer.close(index);
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'tools',title:'Operating',style:'text-align: right;',width:'150px',group:function(row,index){
									var _title = [],_arry = [];
									switch(row.type){
										case 'cc': //cc防御
											_title =  ['Initial rule'];
										break;
										case 'get':
										case 'post':
										case 'user-agent':
											_title =  ['Rule','Response'];
										break;
										case 'drop_abroad':
											_title =  ['Set','Synchronize'];
										break;
										case 'scan':
										case 'ip_white':
										case 'ip_black':
										case 'url_white':
										case 'url_black':
											_title = ['Set'];
										break;
									}
									for(var j=0;j<_title.length;j++){
										_arry.push({
											title:_title[j],
											event:function(row,index){
												var _type = row.name == 'GET-parameter filter'?'args': row.type
												switch(row.type){
													case 'cc': //cc防御
														_this.set_cc_rule_view({cc_cycle: _this.overall_config.cc.cycle,cc_limit: _this.overall_config.cc.limit,cc_endtime: _this.overall_config.cc.endtime});
													break;
													case 'get': //GET-URI过滤 或 GET-参数过滤
													case 'post': //POST过滤
													case 'user-agent': //User-Agent过滤
														if(j==1){
															_this.set_other_rule_view(row);
														}else{
															OnlineEditFile(0,'/www/server/free_waf/html/'+ (row.type != 'user-agent'?row.type:'user_agent') +'.html');
														}
													break;
													case 'drop_abroad': //禁止海外访问
														if(j==1){
															_this.set_ip_region_view(row.type);
														}else{
															_this.get_sync_cnlist();
														}
													break;
													case 'scan': //常见扫描器
														_this.set_scan_rule_view();
													break;
													case 'ip_white': //IP白名单
														_this.set_ip_region_view(row.type)
													break;
													case 'ip_black': //IP黑名单
														_this.set_ip_region_view(row.type)
													break;
													case 'url_white': //URL白名单
														_this.set_other_rule_one_view({type:row.type})
													break;
													case 'url_black': //URL黑名单
														_this.set_other_rule_one_view({type:row.type})
													break;
												}
											}
										})
									}
									return _arry
								}}
							],
							data:_this.overall_show_config,
							done:function(){

							}
						})
					});
				break;
				case 'site': //站点
					this.get_site_config_list(function(res){
						_this.refresh_table_view({
							el:'#site_table',
							form_id:'site_table', //用于重置
							config:[
								{fid:'siteName',title:'WebSite',type:'link',width:'120px',event:function(row,index){
									_this.set_site_config_view({siteName:row.siteName});
								}},
								{fid:'get',title:'GET',type:'unselect',tips:function(row){return row.total[1].value},event:function(row,index,event){
									_this.set_site_obj_open({siteName:row.siteName,obj:'get'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'post',title:'POST',type:'unselect',tips:function(row){return row.total[0].value},event:function(row,index,event){
									_this.set_site_obj_open({siteName:row.siteName,obj:'post'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'user-agent',title:'UA',type:'unselect',tips:function(row){return row.total[3].value},event:function(row,index,event){
									_this.set_site_obj_open({siteName:row.siteName,obj:'user-agent'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								// {fid:'cookie',title:'Cookie',type:'unselect',tips:function(row){return row.total[4].value},event:function(row,index,event){
								// 	_this.set_site_obj_open({siteName:row.siteName,obj:'cookie'},function(res){
								// 		layer.msg(res.msg,{icon:res.status?1:2});
								// 	});
								// }},
								// {fid:'drop_abroad',title:'Ban abroad',type:'unselect',event:function(row,index){
								// 	_this.set_site_obj_open({siteName:row.siteName,obj:'drop_abroad'},function(res){
								// 		layer.msg(res.msg,{icon:res.status?1:2});
								// 	});
								// }},
								{fid:'cdn',title:'CDN',type:'unselect',event:function(row,index,event){
									_this.set_site_obj_open({siteName:row.siteName,obj:'cdn'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'cc',is_contain:'open',title:'CC defense',type:'unselect',tips:function(row){return row.total[4].value},event:function(row,index,event){
									_this.set_site_obj_open({siteName:row.siteName,obj:'cc'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'open',type:'btswitch',title:'Status',width:'50px',style:'text-align: center;',event:function(row,index,event){
									_this.set_site_obj_open({siteName:row.siteName,obj:'open'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'tools',title:'Operating',style:'text-align: right;',width:'110px',group:[{
									title:'Logs',
									event:function(row,index){
										_this.get_site_logs_list({siteName:row.siteName},function(res){
											if(res.length >0){
												_this.get_site_logs_view(row,res);
											}else{
												layer.msg('No logs',{icon:6});
											}
										});
									}
								},{
									title:'Set',
									event:function(row,index){
										_this.set_site_config_view({siteName:row.siteName});
									}
								}]}
							],
							data:res,
							done:function(res){
							}
						})
					});
				break;
				case 'history': //封锁历史
					this.render_history_data();
				break;
				case 'logs': //操作日志
					this.get_gl_table_page();
				break;
			}
		},
		// 设置站点配置视图
		set_site_config_view:function(obj,callback){
			var _this = this;
			layer.open({
                type: 1,
                title: "Website configuration [ "+ obj.siteName +" ]",
                area: ['760px','610px'],
                closeBtn: 2,
                shadeClose: false,
                content:'<div class="waf_site_body pd20">\
					<div class="waf_switch swicth-sm pb15">\
						<span>Website firewall switch</span>\
						<div class="switch-wrapper site_config_switch swicth-sm">\
							<div class="swicth_container" data-type="1" style="transform: translate3d(0px, 0px, 0px);">\
								<span class="swicth_no"><i>NO</i></span>\
								<span class="swicth_label"></span>\
								<span class="swicth_yes"><i>OFF</i></span>\
								<input type="checkbox" id="waf_swicth_all">\
							</div>\
						</div>\
					</div>\
					<div id="site_config_table"></div>\
					<ul class="waf_tips_list mtl0 c7 ptb10">\
						<li>Note: Most of the configuration here is valid only for the current site!</li>\
					</ul>\
				</div>',
				success:function(index,layero){
					$('.site_config_switch').click(function(){
						var _type = Boolean(parseInt($(this).find('.swicth_container').attr('data-type')));
						_this.set_swicth_view(this,_type);
						_this.set_site_obj_open({siteName:obj.siteName,obj:'open'},function(res){
							_this.refresh_data_total('site');
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					});
					_this.render_site_config(obj,function(res){
						_this.set_swicth_view('.site_config_switch',!res.open);
					});
				}
			});
		},
		// 设置站点规则视图
		set_site_rule_view:function(obj,callback){
			var _this = this;
			layer.open({
				type: 1,
				title: "Edit site rules ["+ obj.siteName +"] - [ "+ obj.name +" ]",
				area: ['800px', '600px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="other_table">\
							<div id="site_rule_table"></div>\
							<ul class="help-info-text c7 ptb10">\
								<li>Inherit the rules that are enabled in the global settings here</li>\
								<li>The settings here are only valid for the current site</li>\
							</ul>\
						</div>',
				success:function(layer,index){
					_this.render_site_rule({siteName:obj.siteName,ruleName:obj.ruleName});
				}
			});
		},
		// 渲染扫描webshell
		render_san_webshell:function(obj,callback){
			var _this = this;
			this.refresh_table_view({
				el:'#scan_webshell_table',
				form_id:'scan_webshell_table', //用于重置
				height:400,
				config:[
					{fid:'0',title:'Text name',templet:function(row,index){
						var _file = Object.keys(row)[0].split('/');
						return '<a href="javascript:;" class="btlink file_rule_link" title="'+ Object.keys(row)[0] +'"  onclick="OnlineEditFile(0,\''+ Object.keys(row)[0]+'\')" >' + _file[_file.length -1] + '</a>';
					}},
					{fid:'1',title:'Rule',width:200,class:'file_rule table-text-cell',templet:function(row,index){
						return  '<span>' + row[Object.keys(row)[0]] + '</span>';
					}},
					{fid:'total',title:'Operating',width:290,style:'text-align: right;',group:[
						{title:'aaPanel detection',event:function(row,index){
							_this.webshell_send_baota({path:Object.keys(row)[0]},function(res){
								layer.msg(res.msg,{icon:res.status?1:2});
							});
						}},{title:'Third party detection',event:function(row,index){
							_this.upload_file_url({path:Object.keys(row)[0]},function(res){
								layer.msg(res.msg,{icon:res.status?1:2});
							});
						}},{title:'open file',event:function(row,index){
							OnlineEditFile(0,Object.keys(row)[0]);
						}},{title:'False positive',event:function(row,index){
							var _file = Object.keys(row)[0];
							layer.confirm('Are you sure to submit a false positive feedback?？', {title:'False positive feedback',icon:0,closeBtn:2}, function () {
								_this.lock_not_webshell({not_path:_file,path:obj['path']},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						}}
					]}
				],
				data:obj.data,
				done:function(res){
					$('#scan_webshell_table .fixed-table .file_rule').hover(function(e){
						var _val = $(this).find('span').text(),_that = $(this);
						$(this).append('<div class="rule_down_icon" style="top:'+ e.currentTarget.offsetTop +'px;right:274px"><i class="iconfont iconxialadown" style="font-size: 20px;"></i></div>')
						$(this).unbind('click').click(function(e){
							if(_that.find('.rule_mask').length === 0){
								_that.append('<div class="rule_mask" style="top:'+ e.currentTarget.offsetTop +'px;"><div class="content">'+ _val +'</div><i class="iconfont iconguanbi" style="font-size: 25px;"></i></div>')
							}
							e.preventDefault();
							e.stopPropagation();
						});
						$('.file_rule').on('click','.iconguanbi',function(e){
							$(this).parent().remove();
							_that.find('.rule_down_icon').remove();
							e.preventDefault();
							e.stopPropagation();
						})
					},function(e){
						$(this).find('.rule_down_icon').remove();
					});
					if(callback) callback(res);
				}
			});
		},
		// 渲染webshell规则
		render_webshell_rule:function(callback){
			var _this = this;
			_this.get_webshell_rule(function(res){
				_this.rule_list = res;
				_this.refresh_table_view({
					el:'#webshell_rule_table',
					form_id:'webshell_rule_table', //用于重置
					height:500,
					config:[
						{fid:'1',title:'Rule',templet:function(row,index){
							return '<div class="" style="width:600px;word-break:break-all;line-height: 20px;">'+ row +'</div>'
						}},
						{fid:'0',title:'Operating',width:'50px',style:'text-align: right;',group:[{title:'Del',event:function(row,index){
							layer.confirm('Whether to delete the rule [ ' + row + ' ], continue?', {title: 'Tips',btn: ['Confirm', 'Cancel'],icon: 0,closeBtn: 2}, function () {
								_this.del_webshell_rule({rule:row},function(res){
									_this.refresh_data_webshell('rule_list');
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						}}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(res);
					}
				});
			});
		},
		// 渲染站点规则
		render_site_rule:function(obj,callback){
			var _this = this;
			_this.get_site_disable_rule({siteName:obj.siteName,ruleName:obj.ruleName},function(res){
				_this.rule_list = res;
				_this.refresh_table_view({
					el:'#site_rule_table',
					form_id:'site_rule_table', //用于重置
					height:425,
					config:[
						{fid:'1',title:'Rule',templet:function(row,index){
							return '<div class="" style="width:450px;word-break:break-all;line-height: 20px;">'+ row[1] +'</div>'
						}},
						{fid:'2',title:'Description',width:'150px'},
						{fid:'0',title:'Status',type:'btswitch',width:'50px',style:'text-align: center;',
							event:function(row,index,event){
								_this.set_site_disable_rule({index:index,ruleName:obj.ruleName,siteName:obj.siteName},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
						}}
					],
					data:res,
					done:function(res){
						if(callback) callback(res)
					}
				});
			});
		},
		// 渲染站点配置
		render_site_config:function(obj,callback){
			var _this = this;
			this.get_site_config_byname({siteName:obj.siteName},function(res){
				var site_config = JSON.parse(JSON.stringify(_this.overall_show_config));
				site_config.splice(7,3);
				var arry = [{name: "Using CDN",ps: "The site uses CDN and can be used to get the client IP correctly.",type: "cdn",open:res.cdn},{name: "File Upload",ps: "File types that are prohibited from being uploaded",type: "disable_upload_ext",open: ""}]
				for(var i=0;i<site_config.length;i++){
					var _type = res[site_config[i]['type']];
					if(site_config[i]['ps'] === undefined)  site_config[i]['ps'] = (res['top'][site_config[i]['type']]['ps'] !== undefined?res['top'][site_config[i]['type']]['ps']:'');
					site_config[i]['open'] = ( ((typeof _type == 'boolean')?_type:(_type!=undefined ?_type['open']:'')));
				}
				site_config[0].ps = '<font style="color:red;">'+ res.cc.cycle +'</font> seconds, requesting the same URI to accumulate more than <font style="color:red;">'+ res.cc.limit +'</font> times, block IP <font style="color:red;">'+ res.cc.endtime +'</font> seconds'
				var site_arry = site_config.concat(arry);
				_this.site_show_config = site_arry;
				_this.site_config = res;
				_this.refresh_table_view({
					el:'#site_config_table',
					form_id:'site_config_table', //用于重置
					config:[
						{fid:'name',title:'Name'},
						{fid:'ps',title:'Description'},
						{fid:'open',type:'btswitch',title:'Status',style:'text-align: center;',event:function(row,index){
							_this.set_site_obj_open({siteName:obj.siteName,obj:row.type},function(res){
								_this.render_site_config(obj);
								layer.msg(res.msg,{icon:res.status?1:2});
							});
						}},
						{fid:'tools',title:'Operating',style:'text-align: right;',width:'90px',group:function(row,index){
							return [{
								title:(row.type == 'get' || row.type == 'post' || row.type == 'user-agent')?'Rule':'Set',
								event:function(row,index){
									switch(row.type){
										case 'cc':
											_this.set_cc_rule_view({cc_cycle:res.cc.cycle,cc_endtime:res.cc.endtime,cc_limit:res.cc.limit,siteName:obj.siteName});
										break;
										case 'get':
										case 'post':
										case 'user-agent':
											var _rule = row.type;
											if(row.name === 'GET-URL filter'){
												_rule = 'url';
											}else if(row.name === 'GET-parameter filter'){
												_rule = 'args';
											}else if(row.type === 'user-agent'){
												_rule = 'user_agent';
											}
											_this.set_site_rule_view({
												siteName:obj.siteName,
												name:row.name,
												ruleName:_rule
											});
										break;
										case 'drop_abroad':
											_this.set_ip_region_view(row.type);
										break;
										case 'scan':
											_this.set_scan_rule_view();
										break;
										case 'cdn':
											_this.set_other_rule_one_view({type:row.type,siteName:obj.siteName})
										break;
										case 'disable_upload_ext':
											_this.set_other_rule_one_view({type:row.type,siteName:obj.siteName})
										break;
									}
								}
							}]
						}},
					],
					data:site_arry,
					done:function(){
						if(callback) callback(res)
					}
				});
			});
		},
		// 渲染操作日志列表
		render_logs_data:function(obj,callback){
			var _this = this;
			if(obj == undefined) obj={p:1}
			this.get_gl_logs({p:obj.p,tojs:obj.tojs},function(res){
				_this.refresh_table_view({
					el:'#logs_table',
					form_id:'logs_table', //用于重置
					config:[
						{fid:'log',title:'Details'},
						{fid:'addtime',title:'Operating time',width:'150px',style:'text-align: right;'}
					],
					data:res.data,
					page:res.page,
					done:function(res,obj){
					}
				});
			});
		},
		// 渲染封锁历史列表
		render_history_data:function(obj,callback){
			var _this = this;
			if(obj == undefined) obj={p:1}
			this.get_safe_logs_ip({p:obj.p},function(res){
				_this.refresh_table_view({
					el:'#history_table',
					form_id:'history_table', //用于重置
					config:[
						{fid:'0',title:'Starting time',type:'link',templet:function(res){return bt.format_data(res[0])}},
						{fid:'1',title:'IP',templet:function(row,index){
							return row[6]?'<a href="javascript:;" class="btlink uncover_ip" title="Unblock current IP" data-ip="'+ row[1] +'">'+ row[1] +'</a>':row[1];
						}},
						{fid:'2',title:'Site'},
						{fid:'3',title:'Blockade reason',templet:function(row,index){
							return row[5] === 'cc'?'CC attack':'Multiple malicious requests';
						}},
						{fid:'4',title:'Blocking time',templet:function(row,index){
							return row[4] + 'Seconds';
						}},
						{fid:'5',title:'Stauts',style:'text-align: right;',templet:function(row,index){
							return row[6]?'<span style="color:red">Blocked</span>':'Unblocked';
						}}
					],
					data:res,
					done:function(res){
						// 解封所有封锁
						$('.uncover_ip').click(function(){
							var _ip = $(this).attr('data-ip');
							layer.confirm('Do you want to unblock the IP from the firewall [ '+ _ip +' ]', { title: 'Unblock the IP address',closeBtn:2,icon:0}, function () {
								_this.remove_waf_drop_ip({ip:_ip},function(res){
									_this.render_history_data();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						});
						$('.history_uncover_page').html(_this.render_logs_pages(10,obj.p,res.length));
						$('.history_uncover_page a').unbind().click(function(e){
							var _page = parseInt($(this).attr('data-page'));
							_this.render_history_data({p:_page});
						});
						if(callback) callback(res)
					}
				})
			});
		},
		// 渲染海外禁用IP地址列表
		render_drop_abroad:function(callback){
			var _this = this;
			this.get_overall_rule({ruleName:'cn'},function(res){
				_this.drop_abroad_list = res;
				_this.refresh_table_view({
					el:'#ip_region_table',
					form_id:'ip_region_table', //用于重置
					height:340,
					config:[
						{fid:'0',title:'Starting IP',templet:function(row,index){
							return row[0].join('.');
						}},
						{fid:'1',title:'End IP',templet:function(row,index){
							return row[1].join('.');
						}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_drop_abroad({index:index},function(res){
									_this.render_drop_abroad();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){

					}
				});
			});
		},
		// 渲染规则列表
		render_other_conf:function(obj,callback){
			var _this = this;
			this.get_overall_rule({ruleName: obj.ruleName},function(res){
				_this.rule_list = res;
				_this.refresh_table_view({
					el:'#other_conf_table',
					form_id:'other_conf_table', //用于重置
					height:340,
					config:[
						{fid:'1',title:'Rule',templet:function(row,index){
							return '<div class="" style="width:450px;word-break:break-all;line-height: 20px;">'+ row[1] +'</div>'
						}},
						{fid:'2',title:'Description',width:'150px'},
						{fid:'0',title:'Status',type:'btswitch',width:'50px',style:'text-align: center;',
							event:function(row,index,event){
								_this.set_overall_rule_state({index:index,ruleName:obj.ruleName},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
						}},
						{fid:'tools',title:'Operating',width:'110px',style:'text-align: right;',group:function(row,index){
							var _arry = [{
								title:'Edit',
								event:function(row,index,event,el){
									var _tr = $(el).parent().parent().parent();
									$(_tr).find('td:eq('+0+')').html('<textarea class="waf-input waf-table-textarea waf-rule-val" style="width:440px;">'+ row[1] +'</textarea>');
									$(_tr).find('td:eq('+1+')').html('<input type="text" class="waf-input waf-rule-ps" value="'+ row[2] +'" style="width:110px"/>');
									$(_tr).find('td:eq('+2+')').html('');
									$(_tr).find('td:eq('+3+')').html('<span><a class="btlink save_table_data" href="javascript:;">Save</a>&nbsp;|&nbsp;<a class="btlink clear_table_data" href="javascript:;">Cancel</a></span>');
									$('.save_table_data').click(function(e) {
										_this.modify_overall_rule({
											index:index,
											ruleBody:$('.waf-rule-val').val(),
											rulePs:$('.waf-rule-ps').val(),
											ruleName:obj.ruleName
										},function(res) {
											_this.render_other_conf({ruleName:obj.ruleName});
											layer.msg(res.msg,{icon:res.status?1:2});
										});
									});
									$('.clear_table_data').click(function(e) {
										_this.waf_table_list.other_conf_table.reset();
									});
								}}];
								if(row[3]){ _arry.push({
									title:'Del',
									event:function(row,index){
										bt.confirm({title:'Delete rule',msg:'Do you really want to delete this filter rule?',icon:3,closeBtn:2},function(){
											_this.remove_overall_rule({ruleName:obj.ruleName,index:index},function(res){
												_this.render_other_conf({ruleName:obj.ruleName});
												layer.msg(res.msg,{icon:res.status?1:2});
											})
										});
									}});
								}
							return _arry;
						}},
					],
					data:res,
					done:function(res){

					}
				});
			});
		},
		// 渲染ip白名单
		render_ip_white:function(callback){
			var _this = this;
			this.get_overall_rule({ruleName:'ip_white'},function(res){
				_this.ip_config_list = res;
				_this.refresh_table_view({
					el:'#ip_region_table',
					form_id:'ip_region_table', //用于重置
					height:305,
					config:[
						{fid:'0',title:'Starting IP',templet:function(row,index){
							return row[0].join('.');
						}},
						{fid:'1',title:'End IP',templet:function(row,index){
							return row[1].join('.');
						}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_ip_white({index:index},function(res){
									_this.render_ip_white();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(res);
					}
				});
			});
		},
		// 渲染ip黑名单
		render_ip_black:function(obj,callback){
			var _this = this;
			this.get_overall_rule({ruleName:'ip_black'},function(res){
				_this.ip_config_list = res;
				_this.refresh_table_view({
					el:'#ip_region_table',
					form_id:'ip_region_table', //用于重置
					height:305,
					config:[
						{fid:'0',title:'Starting IP',templet:function(row,index){
							return row[0].join('.');
						}},
						{fid:'1',title:'End IP',templet:function(row,index){
							return row[1].join('.');
						}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_ip_black({index:index},function(res){
									_this.render_ip_black();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(res);
					}
				});
			});
		},
		// 渲染url白名单
		render_url_white:function(obj,callback){
			var _this = this;
			this.get_overall_rule({ruleName:'url_white'},function(res){
				_this.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table', //用于重置
					height:305,
					config:[
						{title:'URL',templet:function(row,index){return row;}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_url_white({index:index},function(res){
									_this.render_url_white();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(res);
					}
				});
			});
		},
		// 渲染url黑名单
		render_url_black:function(obj,callback){
			var _this = this;
			this.get_overall_rule({ruleName:'url_black'},function(res){
				_this.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table', //用于重置
					height:305,
					config:[
						{title:'URL',templet:function(row,index){return row;}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_url_black({index:index},function(res){
									_this.render_url_black();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(res);
					}
				});
			});
		},
		// 渲染CDN表格
		render_cdn_table:function(obj,callback){
			var _this = this;
			_this.get_site_cdn_header({siteName:obj.siteName},function(res){
				_this.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table', //用于重置
					height:305,
					config:[
						{title:'header',templet:function(row,index){return row;}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_site_cdn_header({siteName:obj.siteName,cdn_header:row},function(res){
									_this.render_cdn_table(obj);
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(data);
					}
				});
			});
		},
		// 渲染禁止上传列表
		render_disable_upload:function(obj,callback){
			var _this = this;
			_this.get_site_rule({siteName:obj.siteName,ruleName:'disable_upload_ext'},function(res){
				_this.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table', //用于重置
					height:305,
					config:[
						{title:'Rule',templet:function(row,index){return row;}},
						{title:'Operating',width:'50px',style:'text-align: right;',group:[{
							title:'Delete',
							event:function(row,index){
								_this.remove_site_rule({siteName:obj.siteName,index:index,ruleName:obj.ruleName},function(res){
									_this.render_disable_upload(obj);
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){
						if(callback) callback(data);
					}
				});
			});
		},
		// 渲染日志分页
		render_logs_pages:function(pages,p,num){
			return '<a class="nextPage" data-page="1">Home</a>'+ (p != 1?'<a class="nextPage" data-page="'+ (p-1) +'">Previous</a>':'') + (pages == num?'<a class="nextPage" data-page="'+ (p+1) +'">Next</a>':'')+'<span class="Pcount">Page '+ p +'</span>';
		},
		// 渲染站点日志
		render_site_logs:function(obj,callback){
			var _this = this;
			this.get_safe_logs({siteName:obj.siteName,toDate:obj.toDate,p:obj.p},function(res){
				_this.refresh_table_view({
					el:'#site_logs_table',
					form_id:'site_logs_table', //用于重置
					config:[
						{fid:'0',width:'150px',title:'Time'},
						{fid:'1',title:'User IP',type:'link',event:function(row,index){
							layer.confirm('Did you add <span style="color:red">' + row[1] + '</span> to the IP blacklist?', { title: 'Join the IP blacklist', closeBtn: 2,icon:0}, function () {
								_this.add_ip_black({start_ip:row[1],end_ip:row[1]},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						}},
						{fid:'2',title:'Type'},
						{fid:'3',title:'URL address',templet:function(row,index){return _this.escapeHTML(row[3])}},
						{title:'Status',templet:function(row,index){return 'Blocked';}},
						{fid:'5',title:'Filter'},
						{fid:'tools',title:'Operating',width:'160px',style:'text-align: right;',group:[{
							title:'False positive',
							event:function(row,index){
								layer.confirm('Are you sure to submit a false positive feedback?', { title: 'False positive feedback', closeBtn: 2, icon: 3 }, function () {
									var rule_arry = row[6].split(" &gt;&gt; ");
									_this.add_url_white({url_rule:row[3]},function(res){
										layer.msg(rdata.msg, {icon: 1});
										if (rule_arry[1] != undefined) { $.get('https://www.bt.cn/Api/add_waf_logs?data=' + rule_arry[1], function (rdata) { }, 'jsonp') }
									});
								});
							}
						},{
							title:'Details',
							event:function(row,index){
								var filter_rule = '',rule_arry = row[6].split(" &gt;&gt; "),incoming_value = '', risk_value = '';
								if (rule_arry.length == 0) filter_rule = rule_arry[0]
								incoming_value = rule_arry[1] == undefined ? 'Empty' : rule_arry[1];
								risk_value = incoming_value.match(new RegExp(rule_arry[0].replace(/\//g, '\\/'), 'i'));
								risk_value = risk_value ? risk_value[0] : 'Empty';
								layer.open({
									type: 1,
									title: "[ "+ row[0] + " ] Details",
									area: '600px',
									closeBtn: 2,
									shadeClose: false,
									content: '<div class="pd15 lib-box">\
											<table class="table" style="border:#ddd 1px solid; margin-bottom:10px">\
											<tbody><tr><th>Time</th><td>'+ _this.escapeHTML(row[0]) + '</td><th>User IP</th><td><a class="btlink add_log_ip_black"  title="Add to blacklist">' + _this.escapeHTML(row[1]) + '</a></td></tr><tr><th>Type</th><td>' + _this.escapeHTML(row[2]) + '</td><th>Filter</th><td>' + _this.escapeHTML(row[5]) + '</td></tr></tbody></table>\
											<div><b style="margin-left:10px">URI address</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ _this.escapeHTML(row[3]) + '</div></div>\
											<div><b style="margin-left:10px">User-Agent</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ _this.escapeHTML(row[4]) + '</div></div>\
											<div><b style="margin-left:10px">Filtering rules</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ _this.escapeHTML(rule_arry[0]) + '</div></div>\
											<div><b style="margin-left:10px">Incoming value</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ _this.escapeHTML(incoming_value) + '</div></div>\
											<div><b style="margin-left:10px">Risk value</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ _this.escapeHTML(risk_value) + '</div></div>\
										</div>',
									success:function(){
										$('.add_log_ip_black').click(function(){
											layer.confirm('Did you add <span style="color:red">' + row[1] + '</span> to the IP blacklist?', { title: 'Add to blacklist', closeBtn: 2 }, function () {
												_this.add_ip_black({start_ip:row[1],end_ip:row[1]},function(res){
													layer.msg(res.msg,{icon:res.status?1:2});
												});
											});
										});
									}
								})
							}
						}]}
					],
					data:res,
					done:function(res){
						$('.site_logs_page').html(_this.render_logs_pages(10,obj.p,res.length));
						$('.site_logs_page a').unbind().click(function(e){
							var _page = parseInt($(this).attr('data-page'));
							_this.render_site_logs({siteName:obj.siteName,toDate:obj.toDate,p:_page});
						});
					}
				});
			});
		},
		// 规则转码
		escapeHTML:function(val) {
			val = "" + val;
			return val.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, '&quot;').replace(/'/g, "‘").replace(/\(/g, "&#40;").replace(/\&#60;/g, "&lt;").replace(/\&#62;/g, "&gt;").replace(/`/g, "&#96;").replace(/=/g, "＝");
		},
		// 添加千位分界符
		addThousands:function(num) {
			var reg = /\d{1,3}(?=(\d{3})+$)/g;
			if ( num &&num.toString().indexOf('.') == -1) {
				return (num + '').replace(reg, '$&,');
			} else {
				return num.toString().replace(/(\d)(?=(\d{3})+\.)/g, function ($0, $1) {
					return $1 + ",";
				});
			}
		},
		// 添加黑名单
		add_log_ip_black:function(row){
			var _this = this;
			layer.confirm('Do you add <span style="color:red">' + row + '</span> to the IP blacklist? ', { title: 'Add to blacklist', closeBtn: 2 }, function () {
				_this.add_ip_black({start_ip:row,end_ip:row},function(res){
					layer.msg(res.msg,{icon:res.status?1:2});
				});
			});
		},
		// 渲染下载链接
		render_download_link:function(content, filename) {
			// 创建隐藏的可下载链接
			var eleLink = document.createElement('a');
			eleLink.download = filename;
			eleLink.style.display = 'none';
			// 字符内容转变成blob地址
			var blob = new Blob([content]);
			eleLink.href = URL.createObjectURL(blob);
			// 触发点击
			document.body.appendChild(eleLink);
			eleLink.click();
			// 然后移除
			document.body.removeChild(eleLink);
		},
		// 导入和导出视图
		import_or_export_view:function(type,data,ip_data){
            var _this = this;
			layer.open({
				type: 1,
				title:(data?'Import':'Export')+"IP"+(type=='ip_white'?'White':'black')+"List data",
				area: ['400px', '390px'],
				closeBtn: 2,
				shadeClose: false,
				btn:[(data?'Confirm':'Export configuration file'),'Cancel'],
				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" '+ (data?'placeholder="The import format is as follows：[[[127, 0, 0, 1],[127, 0, 0, 255]]]"':'') +' name="config">'+ (ip_data != undefined?JSON.stringify(ip_data):'') +'</textarea></div>',
				yes:function(layero,index){
					var _config = $('[name=config]').val();
					if(data){
						if(_config == ''){
							layer.msg('Import data cannot be empty',{icon:2});
							return false;
						}
						_this.import_data({s_Name:type,pdata:_config},function(res){
							laeyr.msg(res.msg,{icon:1});
						});
					}else{
						_this.render_download_link(_config,  type+'.json');
					}
					return false;
				}
			});
		},
		// 设置其他规则库2
		set_other_rule_one_view:function(obj){
			var _title = '',_pl = '',_this = this;
			switch(obj.type){
				case 'url_white':
					_title = 'Manage URL whitelist',_pl = 'URL address, support for regular expressions';
				break;
                case 'url_black':
					_title = 'Manage URL blacklist',_pl = 'URL address, support for regular expressions';
				break;
				case 'cdn':
					_title = 'Management website CDN-Headers【'+ obj.siteName +'】',_pl = 'header Name';
				break;
				case 'disable_upload_ext':
					_title = 'Do not upload file types [ '+ obj.siteName +' ]',_pl = 'Extension, no dot (.), example: sql';
				break;
			}
			layer.open({
				type: 1,
				title: _title,
				area: ['550px', '530px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="other_rule_table">\
						<div class="waf-form-input">\
							<input type="text" class="waf-input" name="rule_url" placeholder="'+ _pl +'" />\
							<button class="btn btn-success btn-sm va0 pull-right add_other_rule">Add</button>\
						</div>\
						<div id="other_rule_table"></div>\
						<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='url_white'?'block':'none' )+'">\
							<li>All rules are invalid for URLs in the whitelist, including IP blacklists and URL blacklists.</li>\
						</ul>\
                        <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='url_black'?'block':'none' )+'">\
                            <li>URLs prohibited from user access, except when URL whitelist and IP whitelist exist.</li>\
                        </ul>\
						<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='cdn'?'block':'none' )+'">\
							<li>The firewall will try to get the client IP in the above header</li>\
						</ul>\
						<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='disable_upload_ext'?'block':'none' )+'">\
							<li>Rule values are not case sensitive except for regular expression statements. It is recommended to use lowercase for uniform use.</li>\
							<li>Just fill in the extensions that are forbidden to access, as I wish to prohibit uploading *.php files: php</li>\
						</ul>\
					</div>',
				success:function(layero, index){
					switch(obj.type){
						case 'url_white':
							_this.render_url_white();
						break;
						case 'url_black':
							_this.render_url_black();
						break;
						case 'cdn':
							_this.render_cdn_table({siteName:obj.siteName});
						break;
						case 'disable_upload_ext':
							_this.render_disable_upload({siteName:obj.siteName,ruleName:obj.type});
						break;
					}
					$('.add_other_rule').click(function(){
						var rule_url = $('[name=rule_url]');
						switch(obj.type){
							case 'url_white':
								if(rule_url.val() == ''){
									layer.msg('Please enter the URL address',{icon:2});
									return false;
								}
								_this.add_url_white({url_rule:rule_url.val()},function(res){
									_this.render_url_white();
									rule_url.val('');
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							break;
							case 'url_black':
								if(rule_url.val() == ''){
									layer.msg('Please enter the URL address',{icon:2});
									return false;
								}
								_this.add_url_black({url_rule:rule_url.val()},function(res){
									_this.render_url_black();
									rule_url.val('');
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							break;
							case 'cdn':
								if(rule_url.val() == ''){
									layer.msg('Please enter Header',{icon:2});
									return false;
								}
								_this.add_site_cdn_header({siteName:obj.siteName,cdn_header:rule_url.val()},function(res){
									_this.render_cdn_table({siteName:obj.siteName});
									rule_url.val('');
									layer.msg(res.msg,{icon:res.status?1:2});
								});

							break;
							case 'disable_upload_ext':
								if(rule_url.val() == ''){
									layer.msg('Please enter an extension',{icon:2});
									return false;
								}
								_this.add_site_rule({siteName:obj.siteName,ruleName:obj.type,ruleValue:rule_url.val()},function(res){
									_this.render_disable_upload({siteName:obj.siteName,ruleName:obj.type});
									rule_url.val('');
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							break;
						}
					});
				}
			});
		},
		// 设置扫描器视图
		set_scan_rule_view:function(){
			var _this = this;
			layer.open({
				type: 1,
				title: "Common scanner filter rules",
				area: ['600px', '500px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="waf-form scan_rule_form pd20">\
					<div class="waf-lines">\
						<span class="name-l">Header</span>\
						<div class="info-r">\
							<textarea name="scan_args" class="waf-input"></textarea>\
						</div>\
					</div>\
					<div class="waf-lines">\
						<span class="name-l">Cookie</span>\
						<div class="info-r">\
							<textarea name="scan_cookie" class="waf-input"></textarea>\
						</div>\
					</div>\
					<div class="waf-lines">\
						<span class="name-l">Args</span>\
						<div class="info-r">\
							<textarea name="scan_header" class="waf-input"></textarea>\
						</div>\
					</div>\
					<div class="waf-line-tips">\
						<ul class="waf_tips_list">\
							<li class="key">The key and value will be filtered at the same time, please set it carefully.</li>\
							<li>Please use regular expressions, you should back up the original expression before submitting.</li>\
						</ul>\
					</div>\
				</div>',
				btn:['Apply','Close'],
				success:function(index,layero){
					_this.get_overall_rule({ruleName:"scan_black"},function(res){
						$('[name=scan_args]').text(res.args);
						$('[name=scan_cookie]').text(res.cookie);
						$('[name=scan_header]').text(res.header);
					});
				},
				yes:function(layero,index){
					var scan_args = $('[name=scan_args]').val(),scan_cookie = $('[name=scan_cookie]').val(),scan_header = $('[name=scan_header]').val();
					_this.save_scan_rule({header:scan_header,cookie:scan_cookie,args:scan_args},function(res){
						layer.msg(res.msg,{icon:res.status?1:2});
					});
				}
			});
		},
		// 设置CC规则状态视图
		set_cc_rule_view:function(obj){
			var _this = this,_btn = ['Apply'];
			if(!obj.siteName) _btn.push('Global Apply')
			layer.open({
                type: 1,
                title: "Set CC rules"+(obj.siteName?'[ '+ obj.siteName +' ]':''),
                area: '490px',
                closeBtn: 2,
                shadeClose: false,
				btn:['Apply',],
                content:'<div class="waf-form cc_rule_form pd20">\
					<div class="waf-line">\
						<span class="name-l">Cycle</span>\
						<div class="info-r">\
							<input type="number" name="cc_cycle" value="'+ obj.cc_cycle +'" class="waf-input" />\
							<span class="waf_input_tips">Sec</span>\
						</div>\
					</div>\
					<div class="waf-line">\
						<span class="name-l">Frequency</span>\
						<div class="info-r">\
							<input type="number" name="cc_limit" value="'+ obj.cc_limit +'" class="waf-input" />\
							<span class="waf_input_tips">Times</span>\
						</div>\
					</div>\
					<div class="waf-line">\
						<span class="name-l">Block time</span>\
						<div class="info-r">\
							<input type="number" name="cc_endtime" value="'+ obj.cc_endtime +'" class="waf-input" />\
							<span class="waf_input_tips">Sec</span>\
						</div>\
					</div>\
					<div class="waf-line-tips">\
						<ul class="waf_tips_list">\
							<li class="key" style="display:'+ (obj.siteName?'none':'list-item') +'">The initial value is set here, it will be inherited when the site is newly added, and it is invalid for the existing site.</li>\
							<li class="key" style="display:'+ (!obj.siteName?'none':'list-item') +'">The settings here are only valid for the current site.</li>\
							<li><span class="waf_cc_cycle key">'+ obj.cc_cycle +'</span> The cumulative request for the same URL exceeds <span class="waf_cc_limit key">'+ obj.cc_limit +'</span> times in seconds, triggering CC defense and blocking this IP <span class ="waf_cc_endtime key">'+ obj.cc_endtime +'</span> seconds</li>\
							<li class="key" style="display:'+ (!obj.siteName?'none':'list-item') +'">请不要设置过于严格的CC规则,以免影响正常用户体验</li>\
						</ul>\
					</div>\
				</div>',
				success:function(index,layero){
					var arry = ['cc_cycle','cc_limit','cc_endtime'];
					for(var i=0;i<arry.length;i++){
						(function(i){
							$('[name="'+ arry[i] +'"]').on('keyup click',function(){
								$('.waf_'+arry[i]).html($(this).val());
							});
						})(i)
					}
				},
				yes:function(index,layero){
					var cc_cycle = $('[name="cc_cycle"]').val(),cc_limit = $('[name="cc_limit"]').val(),cc_endtime = $('[name="cc_endtime"]').val();
						if(cc_cycle == 0 || cc_limit == 0 || cc_endtime == 0){
							layer.msg('The rule parameter cannot be 0, please re-enter!',{icon:1});
							return false;
						}
					_this[!obj.siteName?'set_cc_conf':'set_site_cc_conf']({siteName:obj.siteName,cycle:cc_cycle,limit:cc_limit,endtime:cc_endtime,is_open_global:0},function(res){
						if(obj.siteName){
							_this.render_site_config({siteName:obj.siteName});
						}else{
							_this.refresh_data_total('overall');
						}
						layer.close(index);
						layer.msg(res.msg,{icon:res.status?1:2});
					});
				},
				btn2:function(index,layero){
					var cc_cycle = $('[name="cc_cycle"]').val(),cc_limit = $('[name="cc_limit"]').val(),cc_endtime = $('[name="cc_endtime"]').val();
						if(cc_cycle == 0 || cc_limit == 0 || cc_endtime == 0){
							layer.msg('The rule parameter cannot be 0, please re-enter!',{icon:1});
							return false;
						}
					_this.set_cc_conf({cycle:cc_cycle,limit:cc_limit,endtime:cc_endtime,is_open_global:1},function(res){
						_this.refresh_data_total('overall');
						layer.close(index);
						layer.msg(res.msg,{icon:res.status?1:2});
					});
					return false;
				}
			});
		},
		// 设置其他规则配置视图
		set_other_rule_view:function(row){
			var _type = '' ,_this = this;
			if(row.name == 'GET-parameter filter'){
				_type = 'args';
			}else if(row.name == 'GET-URL filter'){
				_type = 'url';
			}else if(row.type == 'user-agent'){
				_type = 'user_agent';
			}else{
				_type = row.type;
			}
			layer.open({
				type: 1,
				title: "Edit rule [ " + row.name + " ]",
				area: ['800px', '600px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="other_table">\
							<div class="waf-form-input">\
								<input type="text" class="waf-input" name="ruleValue" placeholder="Rule content, please use regular expressions" />\
								<input type="text" class="waf-input" name="rulePs" placeholder="Description" />\
								<button class="btn btn-success btn-sm va0 pull-right add_overall_rule">Add</button></div>\
							<div id="other_conf_table"></div>\
							<ul class="help-info-text c7 ptb10">\
								<li style="color:red;">Note: If you don\'t understand regular expressions, don\'t arbitrarily modify the rules.</li>\
								<li>You can add or edit rule content, but use regular expressions</li>\
								<li>Built-in rules allow modification, but can\'t be deleted directly, you can set the rule state to define whether the firewall uses this rule</li>\
							</ul>\
						</div>',
				success:function(index,layero){
					_this.render_other_conf({ruleName:_type});
					$('.add_overall_rule').click(function() {
						var _ruleValue = $('[name=ruleValue]'),_rulePs = $('[name=rulePs]');
						_this.add_overall_rule({
							ruleValue:_ruleValue.val(),
							ps:_rulePs.val(),
							ruleName:_type
						},function(res){
							_this.render_other_conf({ruleName:_type});
							_ruleValue.val('');
							_rulePs.val('');
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					});
				}
			});
		},
		// 设置IP段视图（常见扫描器、IP黑、白名单）
		set_ip_region_view:function(type){
			var _this = this;
			layer.open({
				type: 1,
				title: type == 'drop_abroad'?'Manage domestic IP segments':(type =='ip_white'?'Management IP whitelist':'Management IP blacklist'),
				area: ['550px', '550px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="ip_region_table">\
						<div class="waf-form-input">\
							<input type="text" class="waf-input" name="start_ip" placeholder="Starting IP address" />\
							<input type="text" class="waf-input" name="end_ip" placeholder="End IP address" />\
							<button class="btn btn-success btn-sm va0 pull-right add_ip_region">Add</button>\
						</div>\
						<div id="ip_region_table"></div>\
						<div class="waf-btn-group" style="display:'+( type!='drop_abroad'?'block':'none' )+'">\
							<button class="btn btn-success va0 mr5 mt10 import_ip">Import</button>\
							<button class="btn btn-success va0 mr5 mt10 export_ip">Export</button>\
						</div>\
						<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+ ( type=='drop_abroad'?'block':'none' ) +'">\
							<li>If there are missing domestic IP segments, please add them here.</li>\
						</ul>\
						<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+ ( type=='ip_white'?'block':'none' ) +'">\
							<li>All rules are invalid for IP segments in the whitelist, including IP blacklists and URL blacklists. IP whitelists have the highest priority.</li>\
						</ul>\
						<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+ ( type=='ip_black'?'block':'none' ) +'">\
							<li>The IP segment in the blacklist will be forbidden, except for those already existing in the IP whitelist.</li>\
						</ul>\
					</div>',
				success:function(layero, index){
					switch(type){
						case 'drop_abroad':
							_this.render_drop_abroad();
						break;
						case 'ip_white':
							_this.render_ip_white();
						break;
						case 'ip_black':
							_this.render_ip_black();
						break;
					}
					$('.add_ip_region').click(function(){
						var start_ip = $('[name=start_ip]'),end_ip = $('[name=end_ip]');
						if(start_ip.val() == '' || end_ip.val() == ''){
							layer.msg('Please enter the starting IP address or ending IP address',{icon:2});
							return false;
						}else if(!bt.check_ip(start_ip.val()) || !bt.check_ip(end_ip.val())){
							layer.msg('Please enter the correct IP format',{icon:2});
							return false;
						}
						_this['add_'+type]({start_ip:start_ip.val(),end_ip:end_ip.val()},function(res){
							start_ip.val('');
							end_ip.val('');
							_this['render_'+ type]();
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					});
					// 导入
					$('.import_ip').click(function(){
						_this.import_or_export_view(type,true);
					});
					// 导出
					$('.export_ip').click(function(){
						_this.import_or_export_view(type,false,_this.ip_config_list);
					});
				}
			});
		},
		// 获取站点日志视图
		get_site_logs_view:function(row,dateList){
			var _this = this;
			layer.open({
				type: 1,
				title: "Site Logs-[ "+ row.siteName +" ]",
				area: ['900px', '660px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="site_logs_table">\
							<div class="waf_date_select">\
								<div class="waf-title">Select date: </div>\
								<div class="waf-unselect">\
									<div class="waf-inputs"><div class="waf-inputs-tips">'+ dateList[0] +'</div></div>\
									<dl class="waf-input-list" data-val="'+ dateList[0] +'"></dl>\
								</div>\
							</div>\
							<div id="site_logs_table"></div>\
							<div class="site_logs_page waf_page"></div>\
						</div>',
				success:function(layero,index){
					var _html = '';
					for(var i=0;i<dateList.length;i++){
						_html += '<dd waf-data="'+ dateList[i] +'" '+ ( i==0?'class="waf_checked"':'' ) +'>'+ dateList[i] +'</dd>';
					}
					$('.waf-unselect .waf-input-list').html(_html);
					$('.waf-unselect .waf-inputs').click(function(e){
						if(!$(this).parent().hasClass('active')){
							$(this).parent().addClass('active');
						}else{
							$(this).parent().removeClass('active');
						}
						$(document).unbind('click').click(function(e){
							$('.waf-unselect').removeClass('active');
							$(this).unbind('click');
						});
						e.stopPropagation();
						e.preventDefault();
					});
					$('.waf-input-list dd').click(function(e){
						var _val = $(this).attr('waf-data');
						$(this).addClass('waf_checked').siblings().removeClass('waf_checked');
						$(this).parent().attr('data-val',_val);
						$(this).parent().prev().find('.waf-inputs-tips').html(_val);
						_this.render_site_logs({siteName:row.siteName,toDate:_val,p:1});
					});
					_this.render_site_logs({siteName:row.siteName,toDate:dateList[0],p:1});
				}
			})
		},
		// 表格视图
		refresh_table_view:function(obj){
			var _thead = '<thead><tr>',_tbody = '',_config = obj.config,_data = obj.data,_event = {},_this = this;
				$(obj.el).css({'height':this.is_defined((typeof obj.height),obj.height,'auto')}).addClass(this.is_defined((typeof obj.height),'fixed-table-view'));
				this.waf_table_list[obj.form_id] = obj;
				this.waf_table_list[obj.form_id]['reset']  = function () {
					_this.refresh_table_view(obj)
				}
			for(var i=0;i<_config.length;i++){
				_thead += '<th '+this.is_data_type({name:'width',data:_config[i]}) + this.is_data_type({name:'align',data:_config[i]}) + this.is_data_type({name:'style',data:_config[i]})+'>' + _config[i].title +'</th>';
				if(_config[i]['event']){
					_event[obj.form_id+'_'+_config[i].fid] = {
						name: obj.form_id + '_' + _config[i].fid,
						event: _config[i]['events'] !== undefined?_config[i]['events']:'click',
						method: _config[i]['event']
					};
				}
			}
			_thead += '</tr></thead>';
			_tbody += '<tbody>';
			if(obj.inverted) _data.reverse();
			for(var z=0;z<_data.length;z++){
				_tbody += '<tr data-index="'+ z +'">';
				for(var j=0;j<_config.length;j++){
					var templet = '',_text = '';
					_tbody += '<td '+ (this.is_data_type({name:'style',data:_config[j]})) +' '+ this.is_data_type({name:'class',data:_config[j]}) +'>';
					if(_config[j].templet !== undefined){
						_text = _config[j].templet(_data[z],z);
						_tbody += _text;
					}else if(_config[j].group !== undefined){
						var _arry = [];
						if(typeof _config[j].group === 'function'){
							_arry = _config[j].group(_data[z],z)
						}else{
							_arry = _config[j].group;
						}
						_tbody += '<span>';
						for(var y=0;y<_arry.length;y++){
							_tbody += '<a class="btlink" '+ this.is_defined((typeof _arry[y]['event']),'data-event="'+obj.form_id+'_'+_config[j].fid+'_'+ y +'"')+
								this.is_data_type({name:'href',data:_config[y]}) +
								this.is_data_type({name:'class',data:_config[y]}) +
								this.is_data_type({name:'target',data:_config[y]}) +'>'+ _arry[y].title +'</a>';
							if((y+1) !== _arry.length) _tbody += '&nbsp;|&nbsp;';
							if(_arry[y]['event'] && !_event[obj.form_id+'_'+_config[j].fid+'_' + y]){
								_event[obj.form_id+'_'+_config[j].fid+'_' + y] = {
									name: obj.form_id+'_'+_config[j].fid+'_' + y,
									event: _arry[y]['events'] !== undefined?_arry[y]['events']:'click',
									method: _arry[y]['event']
								};
							}
						}
						_tbody += '</span>';
					}else{
						_text = _data[z][_config[j].fid];
						if(_text !== ''){
							_tbody += '<span>';
							switch(_config[j].type){
								case 'text':
									_tbody += '<span '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"')+'>'+ _text +'</span>';
								break;
								case 'link':
									_tbody += '<a class="btlink" '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"') + this.is_data_type({name:'href',data:_config[j],val:_config[j]['href']?_text:false}) + this.is_data_type({name:'class',data:_config[j]}) + this.is_data_type({name:'target',data:_config[j]}) +'>'+ _text +'</a>';
								break;
								case 'checkbox':
									_tbody += '<input type="checkbox" class="waf_td_checkbox" '+(_data[z][_config[j].fid]?'checked':'') +' '+this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"')+' />';
								break;
								case 'btswitch':
									_tbody += '<input class="btswitch btswitch-ios" id="close_'+ _config[j].fid+'_'+ obj.form_id +'_'+ z +'" '+(_data[z][_config[j].fid]?'checked':'') +' type="checkbox">'+
										'<label class="btswitch-btn" for="close_'+ _config[j].fid +'_'+ obj.form_id +'_'+ z +'" '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"') +'></label>';
								break;
								case 'unselect':
									_tips = _config[j].tips?_config[j].tips(_data[z]):'';
									_open = typeof _data[z][_config[j].fid] == 'object'?_data[z][_config[j].fid][_config[j].is_contain]:_data[z][_config[j].fid];
									_tbody += '<span class="waf_unselect" '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"') +'><i class="waf-icon waf-icon-ok '+ (_open?'waf-checked':'')  +'"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></i><input type="checkbox" '+ (_open?'checked':'')  +'></span>' + ( _tips === ''?'':('<span class="tipsval '+ (_tips>0?'grade_1':'') +'" title="Intercept count: '+ _tips +'">'+ _tips +'</span>'));
								break;
								default:
									_tbody += '<span '+this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"')+'>'+ _text +'</span>';
								break;
							}
							_tbody += '</span>';
						}else{
							_tbody += '<span>--</span>';
						}
					}
					_tbody += '</td>';
				}
				_tbody += '</tr>';
			}
			if(_data.length ===  0){
				_tbody += '<tr><td colspan="'+ _config.length +'" align="center">'+ this.is_defined((typeof obj.tips),obj.tips,'Current data is empty') +'</td></tr>';
			}
			_tbody += '</tbody>';
			$(obj.el).html('<table class="'+ this.is_defined((typeof obj.class),obj.class,'waf_table table table-hover') +'">'+ _thead + _tbody +'</table>');
			if(obj.page){
				if($(obj.el).next().length == 0){
					$(obj.el).after('<div class="waf_page">'+ obj.page +'</div>');
				}else{
					$(obj.el).next().html(obj.page);
				}
			}
			this.bind_evnet_group(obj,_event);
			setTimeout(function(){
				obj.done(obj.data,obj);
			},100);
			if(obj.height !== undefined){
				$(obj.el+' table').before('<table class="'+ _this.is_defined((typeof obj.class),obj.class,'waf_table table table-hover fixed-table-thead') +'">'+ _thead +'</table>')
				$(obj.el+ ' .fixed-table-thead').next().addClass('fixed-table');
				setTimeout(function(){
					$(obj.el+' .fixed-table thead th').each(function(index,el){
						var _offsetWidth = $(this)[0].offsetWidth - 20;
						$(obj.el +' .fixed-table-thead thead th').eq(index).html($(obj.el +' thead th').eq(index).text() +'<div class="waf-fht-cell" style="width:'+ _offsetWidth +'px">');
					});
				},100);
				if($(obj.el+ ' .fixed-table')[0].offsetHeight > parseFloat(obj.height)){
					$(obj.el+ ' .fixed-table-thead').addClass('fixed-table-shadow');
				}
				$(obj.el+ ' .fixed-table-thead').css('top',$(obj.el).scrollTop())
				$(obj.el).scroll(function(){
					$(obj.el+ ' .fixed-table-thead').css('top',$(this).scrollTop());
				});
			}
		},
		// 判断格式
		is_defined:function(is_val,num1,num2){
			return is_val !== 'undefined'?(num1 === undefined?is_val:num1):(num2 === undefined?'':num2);
		},
		// 判断数据类型 (仅用于表单渲染类型绑定)
		is_data_type:function(obj){
			if(obj.data === undefined){
				return 'href="javascript:;" ';
			}
			if(obj.data[obj.name] !== undefined){
				return obj.name +'="'+ obj.data[obj.name]+'" ';
			}
			if(obj.name == 'href'){
				if(!obj.val){
					return 'href="javascript:;" ';
				}else{
					return 'href="'+ obj.val +'" ';
				}
			}
			return '';
		},
		// 绑定事件组 (仅用于表单渲染事件绑定)
		bind_evnet_group:function(obj,events){
			for(var i in events){
				(function(i){
					$(obj.el +' [data-event='+events[i].name+']').bind(events[i].event,function(e){
						var _index = parseInt($(this).parent().parent().parent().attr('data-index')),
							_data = obj.data[_index];
						events[i].method(_data,_index,e,$(this));
					});
				})(i)
			}
		},
		// 宝塔查杀
		webshell_send_baota:function(obj,callback){
			this.http({
				tips:'Checking files using the Pagoda rule base, please wait...',
				method:'send_baota',
				data:{filename:obj.path},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 第三方查杀
		upload_file_url:function(obj,callback){
			this.http({
				tips:'The file is being detected using a third-party rule base, please wait...',
				method:'upload_file_url',
				data:{filename:obj.path},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置文本
		lock_not_webshell:function(obj,callback){
			this.http({
				tips:'File false positive is being set, please wait...',
				method:'lock_not_webshell',
				data:{path:obj.path,no_path:obj.on_path},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 扫描webshell
		webshell_san_dir:function(obj,callback){
			this.http({
				tips:'Scanning webshell, please wait...',
				method:'san_dir',
				data:{path:obj.path},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加webshell规则
		add_webshell_rule:function(obj,callback){
			this.http({
				tips:'Adding webshell rules, please wait...',
				method:'shell_add_rule',
				data:{rule:obj.rule},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取webshell日志
		get_webshell_log:function(callback){
			this.http({
				tips:'Getting webshell logs, please wait...',
				method:'get_log',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除shell规则
		del_webshell_rule:function(obj,callback){
			this.http({
				tips:'Webshell rules are being deleted, please wait...',
				method:'shell_del_rule',
				data:{rule:obj.rule},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取shell查杀规则列表
		get_webshell_rule:function(callback){
			this.http({
				tips:'Getting a list of webshell killing rules, please wait...',
				method:'shell_get_rule',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 解封封锁所有IP
		clean_waf_drop_ip:function(callback){
			this.http({
				tips:'Unblocking all IPs, please wait...',
				method:'clean_waf_drop_ip',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 解封封锁单个IP
		remove_waf_drop_ip:function(obj,callback){
			this.http({
				tips:'Unblocking IP, please wait...',
				method:'remove_waf_drop_ip',
				data:{ip:obj.ip},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除站点规则库
		remove_site_rule:function(obj,callback){
			this.http({
				tips:'Site rule is being deleted, please wait...',
				method:'remove_site_rule',
				data:{siteName:obj.siteName,ruleName:obj.ruleName,index:obj.index},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加站点规则库
		add_site_rule:function(obj,callback){
			this.http({
				tips:'Adding site rules, please wait...',
				method:'add_site_rule',
				data:{siteName:obj.siteName,ruleName:obj.ruleName,ruleValue:obj.ruleValue},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取站点规则库
		get_site_rule:function(obj,callback){
			this.http({
				tips:'Getting site rules, please wait...',
				method:'get_site_rule',
				data:{siteName:obj.siteName,ruleName:obj.ruleName},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除站点CDN-Header
		remove_site_cdn_header:function(obj,callback) {
			this.http({
				tips:'Deleting website CDN-Header, please wait...',
				method:'remove_site_cdn_header',
				data:{siteName:obj.siteName,cdn_header:obj.cdn_header},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加站点CDN-Header
		add_site_cdn_header:function(obj,callback){
			this.http({
				tips:'Adding website CDN-Header, please wait...',
				method:'add_site_cdn_header',
				data:{siteName:obj.siteName,cdn_header:obj.cdn_header},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取站点CDN-header
		get_site_cdn_header:function(obj,callback){
			this.http({
				tips:'Setting up website CDN-Header, please wait...',
				method:'get_site_cdn_header',
				data:{siteName:obj.siteName},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置站点规则状态
		set_site_disable_rule:function(obj,callback){
			this.http({
				tips:'Setting site rule status, please wait...',
				method:'set_site_disable_rule',
				data:{siteName:obj.siteName,ruleName:obj.ruleName,index:obj.index},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取站点规则
		get_site_disable_rule:function(obj,callback){
			this.http({
				tips:'Getting site rules, please wait...',
				method:'get_site_disable_rule',
				data:{siteName:obj.siteName,ruleName:obj.ruleName},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取站点配置
		get_site_config_byname:function(obj,callback){
			this.http({
				tips:'Getting website configuration, please wait...',
				method:'get_site_config_byname',
				data:{siteName:obj.siteName},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 导入数据
		import_data:function(obj,callback){
			this.http({
				tips:'Importing data, please wait...',
				method:'import_data',
				data:{s_Name:obj.s_Name,pdata:obj.pdata},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取日志
		get_safe_logs:function(obj,callback){
			this.http({
				tips:'Getting logs, please wait...',
				method:'get_safe_logs',
				data:{
					siteName:obj.siteName,
					toDate:obj.toDate,
					p:obj.p
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取站点日志列表
		get_site_logs_list:function(obj,callback){
			this.http({
				tips:'Getting site log list, please wait...',
				method:'get_logs_list',
				data:{siteName:obj.siteName},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置站点状态
		set_site_obj_open:function(obj,callback){
			this.http({
				tips:'Setting site status, please wait...',
				method:'set_site_obj_open',
				data:{
					siteName:obj.siteName,
					obj:obj.obj
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除URL白名单
		remove_url_white:function(obj,callback){
			this.http({
				tips:'Deleting URL whitelist, please wait...',
				method:'remove_url_white',
				data:{index:obj.index},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除URL黑名单
		remove_url_black:function(obj,callback){
			this.http({
				tips:'Deleting URL blacklist, please wait...',
				method:'remove_url_black',
				data:{index:obj.index},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除ip黑名单
		remove_ip_black:function(obj,callback){
			this.http({
				tips:'IP blacklist is being deleted, please wait...',
				method:'remove_ip_black',
				data:{index:obj.index},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除ip白名单
		remove_ip_white:function(obj,callback){
			this.http({
				tips:'IP whitelist is being deleted, please wait...',
				method:'remove_ip_white',
				data:{index:obj.index},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加url白名单
		add_url_white:function(obj,callback){
			this.http({
				tips:'Adding a URL whitelist, please wait...',
				method:'add_url_white',
				data:{url_rule:obj.url_rule,},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加url黑名单
		add_url_black:function(obj,callback){
			this.http({
				tips:'Adding a URL blacklist, please wait...',
				method:'add_url_black',
				data:{url_rule:obj.url_rule,},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加ip黑名单
		add_ip_black:function(obj,callback){
			this.http({
				tips:'Adding IP blacklist, please wait...',
				method:'add_ip_black',
				data:{
					start_ip:obj.start_ip,
					end_ip:obj.end_ip
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加ip白名单
		add_ip_white:function(obj,callback){
			this.http({
				tips:'Adding IP whitelist, please wait...',
				method:'add_ip_white',
				data:{
					start_ip:obj.start_ip,
					end_ip:obj.end_ip
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 返回站点列表
		return_site_list:function(callback){
			this.http({
				tips:'Saving scanner rules, please wait...',
				method:'return_site',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 保存扫描器规则
		save_scan_rule:function(obj,callback){
			this.http({
				tips:'Saving scanner rules, please wait...',
				method:'save_scan_rule',
				data:{
					header:obj.header,
					cookie:obj.cookie,
					args:obj.args
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除国内IP
		remove_drop_abroad:function(obj,callback){
			this.http({
				tips:'Deleting IP, please wait...',
				method:'remove_cnip',
				data:{
					index:obj.index
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加国内IP
		add_drop_abroad:function(obj,callback){
			this.http({
				tips:'Adding IP, please wait...',
				method:'add_cnip',
				data:{
					start_ip:obj.start_ip,
					end_ip:obj.end_ip
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 同步云端IP库
		get_sync_cnlist:function(callback){
			this.http({
				tips:'Updating domestic IP library from the cloud, please wait...',
				method:'sync_cnlist',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 编辑配置规则
		modify_overall_rule:function(obj,callback){
			this.http({
				tips:'Deleting rule, please wait...',
				method:'modify_rule',
				data:{
					index:obj.index,
					ruleBody:obj.ruleBody,
					rulePs:obj.rulePs,
					ruleName:obj.ruleName
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 删除指定配置规则
		remove_overall_rule:function(obj,callback){
			this.http({
				tips:'Deleting rule, please wait...',
				method:'remove_rule',
				data:{
					index:obj.index,
					ruleName:obj.ruleName
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 添加指定配置规则
		add_overall_rule:function(obj,callback){
			this.http({
				tips:'Adding rules, please wait...',
				method:'add_rule',
				data:{
					ruleName:obj.ruleName,
					ruleValue:obj.ruleValue,
					ps:obj.ps,
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置指定配置规则
		set_overall_rule_state:function(obj,callback){
			this.http({
				tips:'Setting rule status, please wait...',
				method:'set_rule_state',
				data:{
					index:obj.index,
					ruleName:obj.ruleName,
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取指定配置规则
		get_overall_rule:function(obj,callback){
			this.http({
				tips:'Getting a list of rules, please wait...',
				method:'get_rule',
				data:{ruleName:obj.ruleName},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置cc站点配置
		set_site_cc_conf:function(obj,callback){
			this.http({
				tips:'Setting site CC configuration, please wait...',
				method:'set_site_cc_conf',
				data:{
					siteName:obj.siteName,
					cycle:obj.cycle,
					limit:obj.limit,
					endtime:obj.endtime,
					is_open_global:obj.is_open_global,
					increase:0
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置cc配置
		set_cc_conf:function(obj,callback){
			this.http({
				tips:'Setting CC, please wait...',
				method:'set_cc_conf',
				data:{
					cycle:obj.cycle,
					limit:obj.limit,
					endtime:obj.endtime,
					is_open_global:obj.is_open_global,
					increase:0
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置服务状态
		set_open_switch:function(obj,callback){
			this.http({
				tips:'Setting global configuration switch, please wait...',
				method:'set_obj_open',
				data:{obj:obj.obj},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 设置状态码
		set_status_code:function(obj,callback){
			this.http({
				tips:'Setting response code, please wait...',
				method:'set_obj_status',
				data:{obj:obj.obj,statusCode:obj.code},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取防火墙日志列表
		get_gl_logs:function(obj,callback){
			this.http({
				tips:'Getting firewall blocked IP list, please wait...',
				type:'GET',
				method:'get_gl_logs',
				data:{
					p:obj.p,
					tojs:obj.tojs
				},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取防火墙封锁IP列表
		get_safe_logs_ip:function(obj,callback){
			this.http({
				tips:'Getting firewall blocked IP list, please wait...',
				method:'get_safe_logs',
				data:{siteName:obj.siteName,toDate:obj.toDate,p:obj.p,drop_ip:'1'},
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取防火墙站点配置列表
		get_site_config_list:function(callback){
			this.http({
				tips:'Getting a list of firewall site configurations, please wait...',
				method:'get_site_config',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 同步全局规则库
		update_overall_rule:function(callback){
			this.http({
				tips:'Updating firewall rulebase from the cloud, please wait...',
				method:'sync_rule',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取防火墙全局配置
		get_overall_config:function(callback){
			this.http({
				tips:'Getting firewall global configuration, please wait...',
				method:'get_config',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 获取防火墙统计数据
		get_total_all:function(callback){
			this.http({
				tips:'Getting firewall status, please wait...',
				method:'get_total_all',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 防火墙开关请求
		open_waf_req:function(callback){
			this.http({
				tips:'Getting firewall status, please wait...',
				method:'set_open',
				success:function(res){
					if(callback) callback(res);
				}
			});
		},
		// 请求封装
		http: function (obj) {
            var loadT = '';
            if (obj.load == undefined) obj.load = 0;
            if (obj.url == undefined) {
                if (obj.plugin_name === undefined && this.plugin_name !== undefined) obj.plugin_name = this.plugin_name
                if (!obj.plugin_name || !obj.method) {
                    layer.msg('The plugin class name, or the plugin method name is missing!', {icon: 2 });
                    return false;
                }
            }
            if (obj.load === 0 || obj.tips != '') {
                loadT = layer.msg(obj.tips, {icon: 16,time: 0, shade: 0.3});
            } else if (obj.load === 1 || (obj.tips == undefined && obj.load == undefined)) {
                loadT = layer.load();
            }
            $.ajax({
                type: obj.type===undefined?'POST':obj.type,
                url: obj.url != undefined ? obj.url : ('/plugin?action=a&name=' + obj.plugin_name + '&s=' + obj.method),
                data: obj.data || {},
                timeout: obj.timeout || 99999999,
                complete: function (res) {
                    if (obj.load === 0 || obj.load === 1) layer.close(loadT);
                },
                success: function (rdata) {
                    if (obj.check) {
                        obj.success(rdata);
                        return
                    }
                    if (typeof rdata.status !== 'undefined' && rdata.status === false) {
                        layer.msg(rdata.msg, {icon: 2});
                        return false;
                    }
                    obj.success(rdata);
                },
                error: function (ex) {
                    if (!obj.error) {
                        obj.msg || obj.msg == undefined ? layer.msg('Request process found error!', {icon: 2}) : '';
                        return;
                    }
                    return obj.error(ex);
                }
            });
        }
	}
	free_waf.init();
</script>
